<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Travel Preferences</title>
    <link rel="stylesheet" type="text/css" href="https://cdn.jsdelivr.net/npm/lightpick/css/lightpick.css">
</head>
<body>
    <h1>Travel Preferences</h1>
    <br><br>
    <p>Select Date range</p>
    <input type="text" id="datepicker" placeholder="Select date range"/>
   
    <div id="selectedDates"></div>
    <div id="numberOfDays"></div> <!-- This line was missing -->

    <div id="startDateDisplay"></div> <!-- Display start date here -->
    <div id="endDateDisplay"></div> <!-- Display end date here -->
   
   

    <br><br><br>
    <label for="travelBuddy">Select with whom you want to travel:</label>
    <select id="travelBuddy">
        <option value="" disabled selected>Choose...</option>
        <option value="friends">Friends</option>
        <option value="family">Family</option>
        <option value="couple">Couple</option>
        <option value="solo">Solo</option>
    </select>
    
    <br><br>
    <label for="transportMode">Select transport mode:</label>
    <select id="transportMode">
        <option value="" disabled selected>Choose...</option>
        <option value="car">Car</option>
        <option value="train">Train</option>
        <option value="plane">Plane</option>
        <option value="bus">Bus</option>
    </select>
    <br><br>

    <button id="generateTransportBtn">Select Travel Preferences</button>

    <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.6.0/jquery.min.js"></script> <!-- Include jQuery library -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/moment.js/2.22.2/moment.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/lightpick/lightpick.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.18.0/xlsx.full.min.js"></script>
    
    
    <script>
        var picker = new Lightpick({
        field: document.getElementById('datepicker'),
        singleDate: false,
        numberOfMonths: 2,
        onSelect: function(start, end) {
            // Calculate the number of days selected
            var numberOfDays = moment(end).diff(moment(start), 'days') + 1;

            // Display selected dates and number of days
          // Display selected dates and number of days
        document.getElementById('selectedDates').innerHTML = 'Selected Dates: <br>' 
            + 'Start Date: ' + moment(start).format('YYYY-MM-DD') + '<br>' 
            + 'End Date: ' + moment(end).format('YYYY-MM-DD');
        document.getElementById('numberOfDays').textContent = 'Number of Days: ' + numberOfDays;
                }
            });

        document.getElementById('generateTransportBtn').addEventListener('click', function() {
            // Get selected dates
            var selectedStartDate = picker.getStartDate();
            var selectedEndDate = picker.getEndDate();
            var selectedDates = [selectedStartDate, selectedEndDate];
            // Log the values of the variables
            console.log('Selected Dates:', selectedDates);
                // Sort the selected dates to ensure correct order
                selectedDates.sort(function(a, b) {
                    return a - b;
                });

            // Get start and end dates
            var startDate = moment(selectedDates[0]).format('YYYY-MM-DD');
            var endDate = moment(selectedDates[selectedDates.length - 1]).format('YYYY-MM-DD');

                    // Validate if dates are selected
            if (!selectedStartDate || !selectedEndDate) {
                alert('Please select start and end dates.');
                return; // Exit the function if dates are not selected
            }

            // Get selected travel buddy
            var travelBuddy = document.getElementById('travelBuddy').value;

             // Check if the user has selected a travel buddy
    if (travelBuddy === '') {
        alert('Please select a travel buddy.'); // Display an alert if no travel buddy is selected
        return; // Exit the function to prevent further execution
    }

            // Calculate the number of days selected
            var numberOfDays = moment(endDate).diff(moment(startDate), 'days') + 1;
                
            // Get selected transportMode
            var transportMode = document.getElementById('transportMode').value;
                     // Check if the user has selected a travel buddy
    if (transportMode === '') {
        alert('Please select a transport mode.'); // Display an alert if no travel buddy is selected
        return; // Exit the function to prevent further execution
    }

            console.log('Start Date:', startDate);
            console.log('End Date:', endDate);
            console.log('Travel Buddy:', travelBuddy);
            console.log('Number of Days:', numberOfDays);
            console.log('transportMode:', transportMode);

            // Log the data being sent in the AJAX request
            console.log({
                startDate: startDate,
                endDate: endDate,
                travelBuddy: travelBuddy,
                numberOfDays: numberOfDays,
                transportMode: transportMode
            });
        
         // Send data to the server using AJAX
         $.ajax({
            type: "POST",
            url: "select_date.php", // PHP script to handle database insertion
            data: {
                startDate: startDate,
                endDate: endDate,
                travelBuddy: travelBuddy,
                numberOfDays: numberOfDays,
                transportMode: transportMode
            },
            success: function(response) {
                console.log(response); // Log the response from the server
            },
            error: function(xhr, status, error) {
                console.error('Error:', error);
                alert('Failed to communicate with the server');
            }
        });
        // Function to save data in local storage
function saveDataToLocalStorage() {
    var selectedStartDate = picker.getStartDate();
    var selectedEndDate = picker.getEndDate();
    var travelBuddy = document.getElementById('travelBuddy').value;
    var transportMode = document.getElementById('transportMode').value;

    var state = {
        startDate: selectedStartDate,
        endDate: selectedEndDate,
        travelBuddy: travelBuddy,
        transportMode: transportMode
    };

    localStorage.setItem('travelPreferences', JSON.stringify(state));
}

// Function to restore data from local storage
function restoreDataFromLocalStorage() {
    var state = localStorage.getItem('travelPreferences');
    if (state) {
        state = JSON.parse(state);
        picker.setDateRange(state.startDate, state.endDate);
        document.getElementById('travelBuddy').value = state.travelBuddy;
        document.getElementById('transportMode').value = state.transportMode;
    }
}

// Restore data when the page loads
window.addEventListener('load', restoreDataFromLocalStorage);

// Save data before navigating away from the page
window.addEventListener('beforeunload', saveDataToLocalStorage);

        // // Clear local storage
        // localStorage.clear();
        window.location.href = `meal.php`;
        });

    </script>
</body>
</html>
