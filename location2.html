<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Location Map</title>
    <!-- Include Leaflet CSS -->
    <link rel="stylesheet" href="https://unpkg.com/leaflet/dist/leaflet.css" />

    <!-- Include Leaflet JavaScript -->
    <script src="https://unpkg.com/leaflet/dist/leaflet.js"></script>

    <!-- Include jQuery -->
    <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>

    <!-- Include jQuery UI Autocomplete CSS -->
    <link rel="stylesheet" href="https://code.jquery.com/ui/1.12.1/themes/base/jquery-ui.css">

    <!-- Include jQuery UI Autocomplete JavaScript -->
    <script src="https://code.jquery.com/ui/1.12.1/jquery-ui.js"></script>

    <style>
        /* Global styles */
        body {
            font-family: Arial, sans-serif;
            margin: 0;
            padding: 0;
            background-image: url('location2.jpg'); /* Add background image */
            background-size: cover;
            background-repeat: no-repeat;
            background-position: center;
            color: #333; /* Text color */
        }

        .container {
            max-width: 800px;
            margin: 20px auto;
            padding: 20px;
            background-color: rgba(255, 255, 255, 0.9); /* Semi-transparent white background */
            border-radius: 10px;
            box-shadow: 0 0 10px rgba(0, 0, 0, 0.1);
        }

        h1 {
            text-align: center;
            margin-bottom: 20px;
        }

        /* Form styles */
        form {
            display: flex;
            flex-direction: column;
            align-items: center;
        }

        label {
            font-size: 18px;
            margin-bottom: 10px;
        }

        input[type="text"] {
            width: 100%;
            padding: 10px;
            margin-bottom: 20px;
            border: 1px solid #ccc;
            border-radius: 5px;
            font-size: 16px;
            box-sizing: border-box;
        }

        button {
            width: 100%;
            padding: 15px;
            background-color: #5fd1b4;
            border: none;
            border-radius: 5px;
            font-size: 16px;
            color: #fff;
            cursor: pointer;
            transition: background-color 0.3s ease;
        }

        button:hover {
            background-color: #4cbda2;
        }

        /* Map styles */
        #map {
            height: 400px;
            width: 100%;
            margin-top: 20px;
            border-radius: 5px;
            overflow: hidden;
        }
    </style>
    
</head>
<body>
    <div class="container">
        <h1>Location Map</h1>
        <form>
            <label for="location">Enter Location:</label>
            <input type="text" id="location" name="location" placeholder="Type a location...">
            <button id="selectPlacesBtn">Create Custom Itinerary</button>
        </form>
        <div id="map"></div>
    </div>
    
    <script>
        const apiKey = '5ae2e3f221c38a28845f05b6fb88108160b76562540d181f06c7fb96';
        let marker;
        let map;

        async function getLocationCoordinates(location) {
            try {
                const response = await fetch(`https://api.opentripmap.com/0.1/en/places/geoname?name=${encodeURIComponent(location)}&apikey=${apiKey}`);
                const data = await response.json();
                if (data.lon && data.lat) {
                    return { lat: data.lat, lon: data.lon };
                } else {
                    throw new Error('Coordinates not found for the location');
                }
            } catch (error) {
                console.error('Error:', error);
                throw new Error('Failed to fetch coordinates for the location');
            }
        }

        function displayLocationOnMap(latitude, longitude) {
            if (marker) {
                marker.remove();
            }

            if (!map) {
                map = L.map('map').setView([latitude, longitude], 13);
                L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
                    attribution: '&copy; <a href="https://www.openstreetmap.org/copyright">OpenStreetMap</a> contributors'
                }).addTo(map);
            } else {
                map.setView([latitude, longitude], 13);
            }

            marker = L.marker([latitude, longitude]).addTo(map)
                .bindPopup('Searched Location')
                .openPopup();
        }

        const statesInIndia = ["Andhra Pradesh", "Arunachal Pradesh", "Assam", "Bihar", "Chhattisgarh", "Goa", "Gujarat", "Haryana", "Himachal Pradesh", "Jammu and Kashmir", "Jharkhand", "Karnataka", "Kerala", "Madhya Pradesh", "Maharashtra", "Manipur", "Meghalaya", "Mizoram", "Nagaland", "Odisha", "Punjab", "Rajasthan", "Sikkim", "Tamil Nadu", "Telangana", "Tripura", "Uttar Pradesh", "Uttarakhand", "West Bengal"];

        $(function() {
            $("#location").autocomplete({
                source: statesInIndia
            });
        });

        document.getElementById('location').addEventListener('keypress', async function(event) {
            const key = event.key;
            if (key === 'Enter') {
                event.preventDefault();

                const locationInput = this.value.trim();
                if (locationInput === '') {
                    alert('Please enter a location before searching.');
                    return;
                }

                try {
                    const coordinates = await getLocationCoordinates(locationInput);
                    displayLocationOnMap(coordinates.lat, coordinates.lon);
                } catch (error) {
                    console.error('Error:', error.message);
                    if (marker) {
                        marker.remove();
                    }
                }
            }
        });

        window.addEventListener('load', async function() {
            if (navigator.geolocation) {
                navigator.geolocation.getCurrentPosition(function(position) {
                    displayLocationOnMap(position.coords.latitude, position.coords.longitude);
                });
            } else {
                alert('Geolocation is not supported by your browser.');
            }
        });

        function saveLocation(location) {
            $.ajax({
                type: "POST",
                url: "location2.php",
                data: { location: location },
                success: function(response) {
                    console.log(response);
                },
                error: function(xhr, status, error) {
                    console.error('Error:', error);
                }
            });
        }

        document.getElementById('selectPlacesBtn').addEventListener('click', function() {
            const locationInput = document.getElementById('location').value.trim();
            if (locationInput !== '') {
                saveLocation(locationInput);
                const url = `checkboxes3.html?location=${encodeURIComponent(locationInput)}`;
                window.location.href = url;
            } else {
                alert('Please enter a location before proceeding.');
            }
        });
    </script>
</body>
</html>